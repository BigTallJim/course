# Walkthrough

[Back to Challenge](../08_creating_links.md)

In this walkthrough, I'll show you how I'd:

- Create a User Story from the requirement
- Write a feature test for the User Story
- Solve the feature test by following a TDD cycle.

## Creating the User Story

The requirement is:

* Add new links :construction:

A User Story for this could be:

```
As a user
So I can store bookmark data for later retrieval
I want to add a link to Bookmark Manager
```

> Yours can be different to this. User Stories are a thinking tool, not a 'right/wrong' sort of thing.

##Â Write a feature test for adding links

Let's add a feature test for the user:

- Visiting a page, `/links/new`
- Typing a URL into a form on that page
- Submitting the form
- Seeing the link they just submitted.

> I find it helpful to think out the user's actions in a bullet-point list like the one above, before writing my Capybara test.

In Capybara-speak, these actions look like this:

```ruby
feature 'Adding a new link' do
  scenario 'A user can add a link to Bookmark Manager' do
    visit('/links/new')
    fill_in('url', with: 'http://testlink.com')
    click_button('Submit')

    expect(page).to have_content 'http://testlink.com'
  end
end
```

## Solving the feature test

**I run my test.** It fails, because there is no `/links/new` route. So, we need to create a Sinatra route in `app.rb`:

```ruby
# in app.rb

get '/links/new' do
  erb 'links/new'
end
```

I'll create a directory `links` inside the `views` directory. Inside that directory, I'll add a file called `new.erb`.

> I'm trying to keep the directory structure of my `views` directory looking like my route structure. It's just one of those things I try to do: have common structures all over the place.

**I run my test.** I have a new error: there's nothing to 'fill in' on the page. So, I'll add a form to the `views/links/new.erb` file:

```html
<!-- inside views/links/new.erb -->

<form>
  <input type="text" name="url" />
</form>
```

> I've given the `<input>` tag a `name` attribute of `url`. Right now, this is so Capybara knows how to find it.

**I run my test.** Now I have a new failure: I have no 'Submit' button. Easily solvable:

```html
<!-- inside views/links/new.erb -->

<form>
  <input type="text" name="url" />
  <input type="submit" value="Submit" />
</form>
```

**I run my test.** It looks like my link isn't showing up on the page. Here's what's happening at the moment:

- The user visits the `/links/new` route and `GET`s an HTML page containing a form from the Sinatra application.
- The user fills out the form and submits.
- Submitting a form defaults to sending a `GET` request to the current URL: `/links/new`. 

In other words: right now, submitting the form just fetches a new form from the Sinatra application.

We need to the form data to submit to a different route in Sinatra. In that route, we'll try to save the form data to the database in some way.

We should use a `POST` route to define this route, as we're submitting data to the application to be saved. Also, we should submit to a path called `/links`, as this will make our approach RESTful.

Let's update the form:

```html
<form action="/links" method="post">
  <input type="text" name="url" />
  <input type="submit" value="Submit" />
</form>
```

**I run my test.** As expected, the form submits to a non-existent Sinatra route. Let's define it, and print to the console whenever the route is activated:

```ruby
# in app.rb

get '/links/new' do
  erb 'links/new'
end

post '/links' do
  p "Form data submitted to the /links route!"
end
```

**I run my test.** In my logs, I can see that the form submits to the `/links` route:



[Next Challenge](../09_creating_a_link_model.md)
