# Walkthrough - Many to Many Relationships

[Back to Challenge](../13_many_to_many_relationships.md)

### Overview

In a many-to-many relationship, there are two models and a **join table**:

- one 'sibling' model, `Link`, _belongs to_ and _has many_ `Tag`s.
- the other 'sibling' model, `Tag`, _belongs to_ and _has many_ `Link`s.
- the **join table** _belongs to_ `Link` and _belongs to_ `Tag`.

> Sometimes, many-to-many relationships are called _has and belongs to many_ relationships.

```
  MANY   ≡––≡   MANY
 Links   ≡––≡   Tags
```

One way to store this in a table relationship is to add a **join table**, with two extra columns: the ID of both a `Link` and a `Tag`.

For instance, in the table below are some **Links**:

| id | url                    | title |
|----|-------------------------|---------|
| 1  | http://google.com            | Google       |
| 2  | http://makersacademy.com    | Makers Academy     |

Here are some **Tags**:

| id | content                    |
|----|-------------------------|
| 1  | Research            |
| 2  | Social |

And here is the **LinkTags** join table:

| id | link_id                    | tag_id |
|----|-------------------------|---------|
| 1  | 1            | 1       |
| 2  | 2 | 1      |
| 3  | 2    | 2 |

Starting from the join table and looking up records by the ID given in the link_id and tag_id column, we can tell:

- Google is tagged with 'Research'.
- Makers Academy is tagged with 'Research' and 'Social'.

### REST

Just like one-to-many relationships can have this **nested resource** structure:

```
GET /links/:id/comments # => read comments about this link
POST /links/:id/comments # => make a comment about this link
```

So many-to-many relationships can have them too:

```
GET /links/:id/tags # => read tags for this link
POST /links/:id/tags # => make a tag for this link

GET /tags/:id/links # => read links with this tag
POST /tags/:id/links # => make a link for this tag
```

> You won't have all these routes in your application. For instance: there's no user requirement for Bookmark Manager to allow for the creation of links belonging to a specific tag.

## Making a many-to-many relationship

The stages for making the initial many-to-many relationship, and viewing tags by link, are in [this](https://github.com/sjmog/bookmark_manager/commit/83d91127d9bf51f036d3376033760a8d7da7fce8) commit. They are:

* Add a Tags table
* Add a LinkTags table
* Add routes for creating tags
* Add Tags and LinkTags models
* Add `#tags` method to Link instances

## Filtering links by tags

The stages for making the reverse relationship, and viewing links by tag, are in [this](https://github.com/sjmog/bookmark_manager/commit/ecdcdbca3e859127a2123ce10791f27e20eac76b) commit. They are:

* Complete the `tag.links` part of the many-many relationship.
* Add a `GET /tags/:id/links` route.

One-to-many and many-to-many relationships are the 'tough stuff' of relational databases. Now we'll go onto something a little more 'recipe'-ish: User Registration.

[Next Challenge](../14_extracting_a_database_setup_object.md)
