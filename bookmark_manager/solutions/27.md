# Solution

[Back to Challenge](../27_mailing_the_token.md)

### Mailing the token


```ruby
# spec/send_recovery_link_spec.rb
require 'send_recover_link'

describe SendRecoverLink do
 let(:user){double :user, email: "test@test.com", token: "12345678"}
 let(:mail_gun_client){double :mail_gun_client}

 it "sends a message to mailgun when it is called" do
   params = {from: "bookmarkmanager@mail.com",
             to: user.email,
             subject: "reset your password",
             text: "click here to reset your password http://yourherokuapp.com/reset_password?token=#{user.token}" }
   expect(mail_gun_client).to receive(:send_message).with("sandbox_domain_name_for_your_account.mailgun.org", params)
   described_class.call(user, mail_gun_client)
 end
end
```

```ruby
# lib/send_recover_link.rb
require 'mailgun'
class SendRecoverLink

 def initialize(mailer: nil)
   @mailer = mailer || Mailgun::Client.new("your_api_key")
 end

 def self.call(user, mailer)
   new(mailer: mailer).call(user)
 end

 def call(user)
   mailer.send_message("sandbox_domain_name_for_your_account.mailgun.org", {from: "bookmarkmanager@mail.com",
       to: user.email,
       subject: "reset your password",
       text: "click here to reset your password http://yourherokuapp.com/reset_password?token=#{user.token}" })
 end

 private
 attr_reader :mailer
end
```

```ruby
# Gemfile

gem 'mailgun-ruby'
```
[next challenge](../25_password_recovery.md)
